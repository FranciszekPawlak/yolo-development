# AI Agent System Documentation: News Summarization Service

## Directory Structure

```
apps/
├── agents/
│   ├── news/                 # News bounded context applications
│   │   ├── api/              # API interface for news context
│   │   └── jobs/             # Background jobs for news context
│   └── other-contexts/       # Future bounded contexts

packages/
├── agents/
│   ├── news/                 # News bounded context core packages
│   │   ├── domain/           # Domain layer (entities, value objects, domain services)
│   │   ├── application/      # Application layer (use cases, DTOs, ports)
│   │   ├── infrastructure/   # Infrastructure adapters
│   │   └── interfaces/       # Interface adapters
│   └── shared/               # Shared kernel between bounded contexts
│       ├── domain/           # Shared domain primitives
│       └── infrastructure/   # Shared infrastructure concerns
├── infra/                    # Technical infrastructure packages
│   ├── summarization/        # OpenAI adapter 
│   ├── scraping/             # Web scraping capabilities
│   ├── brevo/                # Brevo email service adapter
│   ├── queue/                # Upstash Queue adapter
│   └── db/                   # Supabase adapter
├── biome-config/             # Code formatting and linting
├── typescript-config/        # TypeScript configuration
```

## Domain Model & Bounded Contexts

### News Bounded Context

#### Domain Layer (packages/agents/news/domain)

##### Aggregates
- `BlogAggregate` - Root entity for blog source with related operations
- `ArticleAggregate` - Root entity for article with content and metadata
- `NewsletterAggregate` - Root entity for newsletter compilation

##### Entities
- `Blog` - Blog source information (root entity of BlogAggregate)
- `Article` - Scraped article data (root entity of ArticleAggregate)
- `Summary` - Article summary generated by AI
- `Newsletter` - Compiled summaries for email delivery (root entity of NewsletterAggregate)

##### Value Objects
- `BlogUrl` - Value object for blog URL validation
- `ArticleContent` - Value object for article content
- `SummaryText` - Value object for summary content
- `EmailRecipient` - Value object for email recipient

##### Domain Services
- `ArticleDuplicationChecker` - Domain service to check article uniqueness
- `SummaryQualityService` - Domain service to validate summary quality

##### Domain Events
- `ArticleScraped` - Event fired when a new article is scraped
- `ArticleSummarized` - Event fired when an article is summarized
- `NewsletterCreated` - Event fired when a newsletter is compiled

##### Repository Interfaces
- `BlogRepository` - Repository interface for Blog aggregate
- `ArticleRepository` - Repository interface for Article aggregate
- `NewsletterRepository` - Repository interface for Newsletter aggregate

#### Application Layer (packages/agents/news/application)

##### Use Cases
- `ScrapeBlogUseCase` - Extract article from blog
- `SummarizeArticleUseCase` - Generate summary for article
- `CreateNewsletterUseCase` - Compile newsletter from summaries
- `SendNewsletterUseCase` - Send email newsletter

##### DTOs
- `BlogDTO` - Data transfer object for blog operations
- `ArticleDTO` - Data transfer object for article operations
- `SummaryDTO` - Data transfer object for summary operations
- `NewsletterDTO` - Data transfer object for newsletter operations

##### Ports
- `ScrapingPort` - Port for scraping capabilities
- `SummarizationPort` - Port for summarization capabilities
- `EmailPort` - Port for email capabilities
- `QueuePort` - Port for queuing capabilities

#### Infrastructure Layer (packages/agents/news/infrastructure)

##### Repository Implementations
- `SupabaseBlogRepository` - Supabase implementation of BlogRepository
- `SupabaseArticleRepository` - Supabase implementation of ArticleRepository
- `SupabaseNewsletterRepository` - Supabase implementation of NewsletterRepository

##### Adapters
- `PlaywrightScrapingAdapter` - Implements ScrapingPort with Playwright
- `OpenAISummarizationAdapter` - Implements SummarizationPort with OpenAI
- `BrevoEmailAdapter` - Implements EmailPort with Brevo
- `UpstashQueueAdapter` - Implements QueuePort with Upstash

#### Interface Layer (packages/agents/news/interfaces)

##### API Controllers (apps/agents/news/api)
- `BlogController` - Manage blog sources
- `ArticleController` - Access articles
- `SummaryController` - Access summaries
- `NewsletterController` - Manage newsletters

##### Job Handlers (apps/agents/news/jobs)
- `ScrapingJobHandler` - Handle blog scraping jobs
- `SummarizationJobHandler` - Handle article summarization jobs
- `NewsletterJobHandler` - Handle newsletter creation/delivery jobs

### Shared Kernel (packages/agents/shared)

#### Shared Domain
- `Entity` - Base entity class
- `AggregateRoot` - Base aggregate root class
- `ValueObject` - Base value object class
- `DomainEvent` - Base domain event

#### Shared Infrastructure
- `RepositoryBase` - Base repository implementation
- `EventDispatcher` - Domain event dispatcher

## Technical Infrastructure (packages/infra)

### infra/scraping
- `WebScraperService` - Extract content from blogs
- `BlogContentParser` - Parse HTML into structured content

### infra/summarization
- `OpenAIClient` - Low-level OpenAI API client
- `PromptTemplates` - Templates for summarization prompts

### infra/brevo
- `BrevoClient` - Low-level Brevo API client
- `EmailTemplateRenderer` - Email template rendering

### infra/queue
- `UpstashQueueClient` - Low-level Upstash Queue client
- `JobSerializer` - Job serialization and deserialization

### infra/db
- `SupabaseClient` - Low-level Supabase client
- `QueryBuilder` - SQL query builder utilities

## Technologies

### apps/agents/news/api
- Express.js
- TypeScript
- OpenAPI/Swagger for documentation
- JWT for authentication
- Express rate limiting

### apps/agents/news/jobs
- Node.js cron
- Vercel Cron
- Upstash Queue for job queuing
- TypeScript

### packages/agents/news
- TypeScript
- Domain models with strict boundaries
- Value objects and immutability
- Event-driven communication between aggregates
- Use case pattern

### packages/infra/scraping
- Playwright for headless browser scraping
- Cheerio for HTML parsing
- Axios for HTTP requests

### packages/infra/summarization
- Native HTTP client for OpenAI API
- Prompt engineering utilities
- Rate limiting and retry logic

### packages/infra/brevo
- Email templating
- Brevo API integration
- Email tracking

### packages/infra/queue
- Upstash Queue client
- Retry mechanisms
- Queue monitoring

### packages/infra/db
- Supabase client
- Data mapping
- Query optimization

### Shared tools
- TypeScript
- ESLint/Biome
- Jest for testing
- Zod for validation
- Day.js for date handling 